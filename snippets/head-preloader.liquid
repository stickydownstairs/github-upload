{%- if template contains 'product' and product.featured_media -%}

	{%- assign image = product.featured_media -%}
	{%- capture srcset -%} 
		{%- if image.width >= 360 -%}{{ image | img_url: '360x' }} 360w,{%- endif -%} 
		{%- if image.width >= 480 -%}{{ image | img_url: '480x' }} 480w,{%- endif -%} 
		{%- if image.width >= 640 -%}{{ image | img_url: '640x' }} 640w,{%- endif -%} 
		{%- if image.width >= 840 -%}{{ image | img_url: '840x' }} 840w,{%- endif -%} 
		{%- if image.width >= 1080 -%}{{ image | img_url: '1080x' }} 1080w,{%- endif -%} 
		{%- if image.width >= 1280 -%}{{ image | img_url: '1280x' }} 1280w,{%- endif -%} 
		{%- if image.width >= 1540 -%}{{ image | img_url: '1540x' }} 1540w,{%- endif -%} 
		{%- if image.width >= 1860 -%}{{ image | img_url: '1860x' }} 1860w,{%- endif -%} 
		{%- if image.width >= 2100 -%}{{ image | img_url: '2100x' }} 2100w{%- endif -%}
	{%- endcapture -%}
	<link rel="preload" as="image" href="{{ image | img_url: '480x' }}" imagesrcset="{{ srcset }}" imagesizes="(max-width: 767px) 100vw, 70vw">

{%- elsif template contains 'collection' -%}
 	{%- for product in collection.products limit: 2 -%}
 		{%- liquid 
 			assign image = product.featured_media
 			assign media_sizes = '(max-width: 768px) calc(50vw - 20px), (min-width: 768px) and (max-width: 948px) 25vw, (min-width: 948px) and (max-width: 1174px) calc((100vw - 200px)/2), calc((100vw - 300px)/4)'
			if product.tags contains 'featured' and settings.grid_enhance_featured_product == true 
				assign media_sizes = '(max-width: 768px) calc(100vw - 20px), (min-width: 768px) and (max-width: 948px) 50vw, (min-width: 948px) and (max-width: 1174px) calc(100vw - 200px), calc((100vw - 300px)/2)'
			endif
		-%}
		{%- if settings.grid_aspect == 'natural' -%}
			{%- capture srcset -%} 
				{%- if image.width >= 360 -%}{{ image | img_url: '360x' }} 360w,{%- endif -%} 
				{%- if image.width >= 480 -%}{{ image | img_url: '480x' }} 480w,{%- endif -%} 
				{%- if image.width >= 640 -%}{{ image | img_url: '640x' }} 640w,{%- endif -%} 
				{%- if image.width >= 840 -%}{{ image | img_url: '840x' }} 840w,{%- endif -%} 
				{%- if image.width >= 1080 -%}{{ image | img_url: '1080x' }} 1080w,{%- endif -%} 
				{%- if image.width >= 1280 -%}{{ image | img_url: '1280x' }} 1280w,{%- endif -%} 
				{%- if image.width >= 1540 -%}{{ image | img_url: '1540x' }} 1540w,{%- endif -%} 
				{%- if image.width >= 1860 -%}{{ image | img_url: '1860x' }} 1860w,{%- endif -%} 
				{%- if image.width >= 2100 -%}{{ image | img_url: '2100x' }} 2100w{%- endif -%}
			{%- endcapture -%}
		{%- else -%}
			{%- liquid 
				assign divide_ratio = 1 | divided_by: image.aspect_ratio
			  assign srcset_360 = 360 | times: divide_ratio | round | prepend: '360x'
			  assign srcset_420 = 420 | times: divide_ratio | round | prepend: '420x'
			  assign srcset_480 = 480 | times: divide_ratio | round | prepend: '480x'
			  assign srcset_640 = 640 | times: divide_ratio | round | prepend: '640x'
			  assign srcset_840 = 840 | times: divide_ratio | round | prepend: '840x'
			  assign srcset_1080 = 1080 | times: divide_ratio | round | prepend: '1080x'
			  assign srcset_1280 = 1280 | times: divide_ratio | round | prepend: '1280x'
			  assign srcset_1540 = 1540 | times: divide_ratio | round | prepend: '1540x'
			  assign srcset_1860 = 1860 | times: divide_ratio | round | prepend: '1860x'
			  assign srcset_2100 = 2100 | times: divide_ratio | round | prepend: '2100x'
			-%}
			{%- capture srcset -%} 
				{%- if image.width >= 360 -%}{{ image | img_url: srcset_360, crop: 'center' }} 360w,{%- endif -%}
				{%- if image.width >= 420 -%}{{ image | img_url: srcset_420, crop: 'center' }} 420w,{%- endif -%}
				{%- if image.width >= 480 -%}{{ image | img_url: srcset_480, crop: 'center' }} 480w,{%- endif -%}
				{%- if image.width >= 640 -%}{{ image | img_url: srcset_640, crop: 'center' }} 640w,{%- endif -%}
				{%- if image.width >= 840 -%}{{ image | img_url: srcset_840, crop: 'center' }} 840w,{%- endif -%}
				{%- if image.width >= 1080 -%}{{ image | img_url: srcset_1080, crop: 'center' }} 1080w,{%- endif -%}
				{%- if image.width >= 1280 -%}{{ image | img_url: srcset_1280, crop: 'center' }} 1280w,{%- endif -%}
				{%- if image.width >= 1540 -%}{{ image | img_url: srcset_1540, crop: 'center' }} 1540w,{%- endif -%}
				{%- if image.width >= 1860 -%}{{ image | img_url: srcset_1860, crop: 'center' }} 1860w,{%- endif -%}
				{%- if image.width >= 2100 -%}{{ image | img_url: srcset_2100, crop: 'center' }} 2100w{%- endif -%}
			{%- endcapture -%}
		{%- endif -%}
		<link rel="preload" as="image" href="{{ image | img_url: '480x' }}" imagesrcset="{{ srcset }}" imagesizes="{{ media_sizes }}">
 	{%- endfor -%}
{%- endif -%}